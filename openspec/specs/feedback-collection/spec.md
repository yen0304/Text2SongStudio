# feedback-collection Specification

## Purpose
TBD - created by archiving change add-text2song-studio. Update Purpose after archive.
## Requirements
### Requirement: Rating Feedback

The system SHALL collect numerical rating feedback for generated audio samples.

#### Scenario: Submit rating with single criterion

- **WHEN** a user submits a rating (1-5 scale) for an audio sample
- **THEN** the system stores the rating associated with the sample
- **AND** records the timestamp and user identifier (if available)

#### Scenario: Submit rating with multiple criteria

- **WHEN** a user submits ratings for multiple criteria (musicality, coherence, emotional alignment)
- **THEN** the system stores each criterion rating separately
- **AND** allows aggregation by criterion type

#### Scenario: Reject invalid rating value

- **WHEN** a user submits a rating outside the valid range (1-5)
- **THEN** the system rejects the request with a validation error

### Requirement: Preference Feedback

The system SHALL collect pairwise preference feedback comparing audio samples.

#### Scenario: Submit A/B preference

- **WHEN** a user indicates a preference between two audio samples (A preferred over B)
- **THEN** the system stores the preference relationship
- **AND** records which sample was preferred and which was rejected

#### Scenario: Submit preference with tie

- **WHEN** a user indicates no preference between two samples (tie)
- **THEN** the system records this as an explicit tie
- **AND** this data is available for training pipelines that support ties

#### Scenario: Submit ranking of multiple samples

- **WHEN** a user ranks multiple samples (e.g., 1st, 2nd, 3rd, 4th)
- **THEN** the system stores all pairwise preferences implied by the ranking
- **AND** each pair is stored as a separate preference record

### Requirement: Qualitative Annotations

The system SHALL collect qualitative feedback through tags and notes.

#### Scenario: Add tags to sample

- **WHEN** a user adds tags to an audio sample (e.g., ["good_rhythm", "poor_melody", "creative"])
- **THEN** the system stores the tags associated with the sample
- **AND** tags are searchable and filterable

#### Scenario: Add free-form notes

- **WHEN** a user adds a text note to an audio sample
- **THEN** the system stores the note with the feedback record
- **AND** notes are available for qualitative analysis

### Requirement: Feedback Retrieval

> Original: The system SHALL allow retrieval and filtering of feedback data.

#### Scenario: Filter feedback by job ID

- **WHEN** a user requests feedback filtered by job ID
- **THEN** the system returns only feedback for audio samples belonging to that job
- **AND** supports pagination for large result sets
- **AND** can be combined with other filters (rating, tags, date range)

### Requirement: Feedback Retrieval by Job

The system SHALL allow retrieval of feedback records associated with a specific generation job.

#### Scenario: Get feedback for a job

- **WHEN** a user requests feedback for a specific generation job ID
- **THEN** the system retrieves all feedback records for audio samples generated by that job
- **AND** returns feedback grouped by audio sample with sample labels (A, B, C, D)

#### Scenario: Get aggregated feedback stats for a job

- **WHEN** a user requests feedback for a completed job
- **THEN** the system returns aggregate statistics including:
  - Total feedback count
  - Average rating across all samples
  - Total samples with feedback
- **AND** individual feedback details per sample

#### Scenario: Handle job with no feedback

- **WHEN** a user requests feedback for a job that has no feedback records
- **THEN** the system returns an empty feedback list with zero counts
- **AND** does not return an error

#### Scenario: Handle non-existent job

- **WHEN** a user requests feedback for a non-existent job ID
- **THEN** the system returns a 404 not-found error

### Requirement: Feedback Deletion

The system SHALL allow users to delete individual feedback records.

#### Scenario: Delete single feedback record

- **WHEN** a user requests deletion of a feedback record by ID
- **THEN** the system permanently removes the feedback record
- **AND** returns confirmation of deletion

#### Scenario: Attempt to delete non-existent feedback

- **WHEN** a user requests deletion of a feedback record that does not exist
- **THEN** the system returns a 404 not-found error

#### Scenario: Cascade delete feedback on job deletion

- **WHEN** a generation job is deleted
- **THEN** the system automatically deletes all feedback records associated with that job's audio samples
- **AND** this happens atomically within the same transaction

### Requirement: Feedback Deletion UI

The system SHALL provide UI controls for deleting feedback.

#### Scenario: Delete feedback from feedback panel

- **WHEN** a user clicks the delete button on a feedback item in the feedback panel
- **THEN** the system shows a confirmation dialog
- **AND** upon confirmation, deletes the feedback
- **AND** refreshes the feedback list

#### Scenario: Delete feedback from feedback history

- **WHEN** a user clicks the delete button on a feedback item in the feedback history
- **THEN** the system shows a confirmation dialog
- **AND** upon confirmation, deletes the feedback
- **AND** updates the history view

#### Scenario: Cancel feedback deletion

- **WHEN** a user clicks the delete button but cancels the confirmation dialog
- **THEN** the feedback record is not deleted
- **AND** the UI remains unchanged

